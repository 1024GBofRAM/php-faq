---
title: "How to work with user passwords and how to securely hash passwords?"
read_time: "1 min"
updated: "october 22, 2014"
---

When you must save user's password in a database you should never ever store them in plain text because of security precautions and privacy protection.
Database where users' passwords are stored might get compromised and by hashing them at least there is another safety mechanism for not revealing them to the
atacker.

{% highlight php %}
<?php

// plain text password example
$password = 'secretcode';

{% endhighlight %}

Cryptography is a large field and quite complex for lot of people so a good rule of a thumb would be to leave it to the experts.

One of the most popular but wrong way of hashing password was once using md5() function that calculates md5 hash of a string. Hashing passwords with md5 (or sha1 or even sha256) is bad because these hashes can get decrypted very fast.

{% highlight php %}
<?php

// plain text password
$password = 'secretcode';

// hash the password with md5
$md5 = md5($password);

{% endhighlight %}

Common solution to preventing decryption is using the salt.

{% highlight php %}
<?php

// plain text password
$password = 'secretcode';

// add random number of random characters - the salt
$salt = '3x%%$bf83#dls2qgdf';

// hash salt and password together
$md5 = md5($salt . $password);
{% endhighlight %}

This is still not good enough though - Rainbow tables.

#### Right way of hashing passwords as of PHP 5.5

Right way of hashing passwords is currently using PHP 5.5 and its [native passwords hashing API](http://php.net/manual/en/book.password.php) which provides
an easy to use wrapper around [crypt](http://php.net/manual/en/function.crypt.php) function.

Example of PHP 5.5 native password hashing API usage:

{% highlight php %}
<?php

// plain text password
$password = 'secretcode';

$options = ['cost' => 12];
echo password_hash($password, PASSWORD_DEFAULT, $options);
{% endhighlight %}

In password_hash function there are two types of algorithms available. PASSWORD_DEFAULT and PASSWORD_BCRYPT. Currently PASSWORD_DEFAULT is PASSWORD_BCRYPT
and as language and cryptography will progress there will be different types of algorithms supported and PASSWORD_DEFAULT will get replaced with that new type of algorithm.
Good advice is to always use PASSWORD_DEFAULT.

The database password's field should be varchar(255) for future proof algorithm changes.

Using your own salt might not be a very good option. Leave that to the experts as well and use above bullet proof solution without setting your own salt. Salt is randomly generated by default in password_hash function.

Another option that is important to mention is the `cost` which controls the hash speed. On servers with better resources `cost` can be increased. There is a script for calculating the cost for your environment in the [PHP manual](http://php.net/manual/en/function.password-hash.php#example-923).

Verifying passwords can be done with [password_verify()](http://php.net/manual/en/function.password-verify.php):

{% highlight php %}
<?php

// this is the hash of the password in above example
$hash = '$2y$12$VD3vCfuHcxU0zcgDvArQSOlQmPv3tXW0TWoteV4QvBYL66khev0oq';

if (password_verify('secretcode', $hash)) {
    echo 'Password is valid!';
} else {
    echo 'Invalid password.';
}
{% endhighlight %}

Another useful function is [password_needs_rehash()](http://php.net/manual/en/function.password-needs-rehash.php) - which checks if given hash matches given options.
This comes handy in case of server hardware upgrade and therefore increasing the `cost` option.

#### Password hashing in PHP versions <5.5

In case you're not yet using PHP 5.5 or above there is a way to secure passwords securely in PHP version > 5.3.7 by using for example PHP library [password_compat](https://github.com/ircmaxell/password_compat). PHP library password_compat works exactly the same way as does the native PHP's 5.5 password hashing API so when you upgrade to PHP 5.5 or above you will not need to refactor your code.

For PHP version below 5.3.6 [phpass](http://www.openwall.com/phpass/) might be a good solution.

Resources:

* [PHP.net passwords FAQ](http://php.net/manual/en/faq.passwords.php)
* [csiphp.com](http://csiphp.com/blog/2012/02/16/encrypt-passwords-for-highest-level-of-security/) - Interesting blog post about encrypting passwords
* [password-validator](https://github.com/jeremykendall/password-validator) - PHP library that validates passwords against PHP's password_hash function using PASSWORD_DEFAULT. Will rehash when needed, and will upgrade legacy passwords with the Upgrade decorator.


